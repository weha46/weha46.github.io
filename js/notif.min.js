document.addEventListener("DOMContentLoaded",()=>{const d=[document.getElementById("notifBtn-lg"),document.getElementById("notifBtn-mobile"),document.getElementById("notifBtn-modal")].filter(Boolean),e=document.getElementById("notifModal"),s=e?.querySelector(".notif-container"),g=e?.querySelector(".closeModal"),m=document.querySelector(".mark-all-read"),u=document.getElementById("textMark"),t=document.getElementById("toggleBall"),h=document.querySelectorAll(".notifBadge"),a=document.querySelectorAll(".post-notif"),n=new Date,c=[];let o=0;const f=e=>{const t=Math.floor((n-new Date(e))/1e3);return t<60?`${t}s ago`:t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`};a.forEach(e=>{const l=new Date(e.dataset.date),s=(n-l)/1e3,t=e.dataset.url,d=e.dataset.title||"Notifikasi baru",i=localStorage.getItem(`notif-read:${t}`)==="true",a=document.querySelector(`.fire-new[data-url="${t}"]`),r=document.querySelector(`.label-new[data-url="${t}"]`);if(s<86400&&!i?a?.classList.remove("opacity-0","hidden"):a?.classList.add("opacity-0","hidden"),s<86400?r?.classList.remove("opacity-0","hidden"):r?.classList.add("opacity-0","hidden"),s<86400){const n=!i;n&&o++;const s=n?"bg-conime-500 dark:bg-conime-500":"bg-gray-600 dark:bg-gray-800",a=f(e.dataset.date);c.push(`
        <a href="${t}" class="notif-item bg-gray-200 dark:bg-gray-800/20 rounded p-3 relative block transition hover:bg-gray-200 dark:hover:bg-gray-800 ${i?"opacity-75 dark:opacity-50":""}" data-url="${t}" data-date="${e.dataset.date}">
          <div class="flex justify-end badge">
            <div class="flex relative justify-center items-center rounded-full">
              <div class="w-3 h-3 opacity-50 rounded-full ${s}"></div>
              <div class="w-2 h-2 absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full ${s}"></div>
            </div>
          </div>
          <h2 class="line-clamp-2 w-[80%] text-sm font-light dark:font-extralight text-gray-900 dark:text-white">${d}</h2>
          <p class="w-full text-right text-xs font-light dark:font-extralight"><time datetime="${e.dataset.date}">${a}</time></p>
        </a>
      `)}}),s&&(s.innerHTML=c.length>0?c.join(""):`<div class="text-center text-sm py-4 text-gray-500 dark:text-gray-400">Tidak ada notifikasi baru.</div>`);const r=()=>{const e=o===0;localStorage.setItem("notif-all-read",e.toString()),e?(t.classList.remove("translate-x-[85%]"),t.classList.add("-translate-x-[85%]","bg-gray-500","dark:bg-gray-500"),t.classList.remove("bg-conime-500","dark:bg-conime-500"),u.innerText="Mark all as unread"):(t.classList.remove("-translate-x-[85%]"),t.classList.add("translate-x-[85%]","bg-conime-500","dark:bg-conime-500"),t.classList.remove("bg-gray-500","dark:bg-gray-500"),u.innerText="Mark all as read")},l=()=>{const t=localStorage.getItem("notif-all-read")==="true";let e=!1;a.forEach(t=>{const s=localStorage.getItem(`notif-read:${t.dataset.url}`)==="true",o=(n-new Date(t.dataset.date))/1e3;o<86400&&!s&&(e=!0)}),h.forEach(n=>{e&&!t?n?.classList.remove("hidden"):n?.classList.add("hidden")})};s?.querySelectorAll(".notif-item").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.url;localStorage.setItem(`notif-read:${t}`,"true"),e.classList.add("opacity-75","dark:opacity-50"),e.querySelectorAll(".badge div").forEach(e=>{e.classList.remove("bg-conime-500","dark:bg-conime-500"),e.classList.add("bg-gray-600","dark:bg-gray-800")}),document.querySelector(`.fire-new[data-url="${t}"]`)?.classList.add("opacity-0","hidden"),h.forEach(e=>e?.classList.add("hidden")),o--,r(),l()})}),m?.addEventListener("click",()=>{const t=localStorage.getItem("notif-all-read")==="true",e=(!t).toString();localStorage.setItem("notif-all-read",e),s?.querySelectorAll(".notif-item").forEach(t=>{const s=t.dataset.url,o=document.querySelector(`.fire-new[data-url="${s}"]`),i=(n-new Date(t.dataset.date))/1e3>86400;e==="true"?(localStorage.setItem(`notif-read:${s}`,"true"),t.classList.add("opacity-75","dark:opacity-50"),t.querySelectorAll(".badge div").forEach(e=>{e.classList.remove("bg-conime-500","dark:bg-conime-500"),e.classList.add("bg-gray-600","dark:bg-gray-800")}),o?.classList.add("opacity-0","hidden")):i||(localStorage.removeItem(`notif-read:${s}`),t.classList.remove("opacity-75","dark:opacity-50"),t.querySelectorAll(".badge div").forEach(e=>{e.classList.remove("bg-gray-600","dark:bg-gray-800"),e.classList.add("bg-conime-500","dark:bg-conime-500")}),o?.classList.remove("opacity-0","hidden"))}),o=e==="true"?0:a.length,r(),l()});const p=()=>{e?.classList.remove("hidden"),requestAnimationFrame(()=>{e?.classList.add("scale-100","opacity-100","translate-y-0","z-[999]"),e?.classList.remove("scale-95","opacity-0","translate-y-10","-z-[999]")})},i=()=>{e?.classList.add("scale-95","opacity-0","translate-y-10","-z-[999]"),e?.classList.remove("scale-100","opacity-100","translate-y-0","z-[999]"),setTimeout(()=>e?.classList.add("hidden"),300)},v=()=>{const t=e&&e.classList.contains("scale-100")&&e.classList.contains("opacity-100")&&e.classList.contains("translate-y-0");t?i():p()};d.forEach(e=>e.addEventListener("click",v)),g?.addEventListener("click",i),document.addEventListener("click",t=>{e&&!e.classList.contains("hidden")&&!e.contains(t.target)&&!d.some(e=>e.contains(t.target))&&i()}),r(),l()})